var safe="url(http://mj.wjsams.com/images/safe.png)";var question="url(http://mj.wjsams.com/images/question.png)";var bomb="url(http://mj.wjsams.com/images/bomb.png)";var empty="rgb(128, 128, 128)";var nrow=10;var ncol=10;var difficulty=0.1;$(document).ready(function() {draw_grid(nrow,ncol);});function draw_grid(nrow,ncol) {a_is_open=mkmultarray(nrow,ncol);a_bombs=mkmultarray(nrow,ncol);a_num_bombs_near=mkmultarray(nrow,ncol);num_bombs=Math.ceil((nrow*ncol)*difficulty);var num_bombs_set=0;var output="";output+="<div id=\"grid_table\">";for(i=0;i<nrow;i++) {for(j=0;j<ncol;j++) {a_is_open[i][j]=false;if(rand(1,num_bombs)==num_bombs) {a_bombs[i][j]=true;} else {a_bombs[i][j]=false;} output+="<div id=\"cell"+i+"_"+j+"\" class=\"cell\" onmousedown=\"cell_click(event, this)\"></div>\n";} output+="<div class=\"clear\"></div>";} output+="</div>";for(i=0;i<nrow;i++) {for(j=0;j<ncol;j++) {a_bombs[i][j]=false;}} while(num_bombs_set<num_bombs) {for(i=0;i<nrow;i++) {for(j=0;j<ncol;j++) {if(num_bombs_set<num_bombs) {if(rand(1,num_bombs)==num_bombs) {if(a_bombs[i][j]!=true) {a_bombs[i][j]=true;num_bombs_set=num_bombs_set+1;}}}}}} for(i=0;i<nrow;i++) {for(j=0;j<ncol;j++) {a_num_bombs_near[i][j]=0;}} for(i=0;i<nrow;i++) {for(j=0;j<ncol;j++) {var ni=i-1;var nj=j;var nei=i-1;var nej=j+1;var ei=i;var ej=j+1;var sei=i+1;var sej=j+1;var si=i+1;var sj=j;var swi=i+1;var swj=j-1 var wi=i;var wj=j-1;var nwi=i-1;var nwj=j-1;if(ni>0&∋<nrow&&nj>0&&nj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[ni][nj]=a_num_bombs_near[ni][nj]+1;}} if(nei>0&&nei<nrow&&nej>0&&nej<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[nei][nej]=a_num_bombs_near[nei][nej]+1;}} if(ei>0&&ei<nrow&&ej>0&&ej<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[ei][ej]=a_num_bombs_near[ei][ej]+1;}} if(sei>0&&sei<nrow&&sej>0&&sej<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[sei][sej]=a_num_bombs_near[sei][sej]+1;}} if(si>0&&si<nrow&&sj>0&&sj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[si][sj]=a_num_bombs_near[si][sj]+1;}} if(swi>0&&swi<nrow&&swj>0&&swj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[swi][swj]=a_num_bombs_near[swi][swj]+1;}} if(wi>0&&wi<nrow&&wj>0&&wj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[wi][wj]=a_num_bombs_near[wi][wj]+1;}} if(nwi>0&&nwi<nrow&&nwj>0&&nwj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[nwi][nwj]=a_num_bombs_near[nwi][nwj]+1;}}}} $("div#grid").html(output);apply_css_default_style();for(i=0;i<nrow;i++) {for(j=0;j<ncol;j++) {if(a_bombs[i][j]==true) {$("div#cell"+i+"_"+j).css("background-image",bomb).css("background-repeat","no-repeat").css("background-position","50% 50%");} $("div#cell"+i+"_"+j).html(a_num_bombs_near[i][j]);}}} function rand(min,max) {var argc=arguments.length;if(argc===0) {min=0;max=2147483647;} else if(argc===1) {throw new Error('Warning: rand() expects exactly 2 parameters, 1 given');} return Math.floor(Math.random()*(max-min+1))+min;} function mkmultarray(nrow,ncol) {var a_array=new Array();for(i=0;i<nrow;i++) {a_array[i]=new Array();for(j=0;j<ncol;j++) {a_array[i][j]=null;}} return a_array;} function get_i(str) {var regex=new RegExp("^cell([0-9]+)_([0-9]+)$");var i=str.replace(regex,"$1");return i;} function get_j(str) {var regex=new RegExp("^cell([0-9]+)_([0-9]+)$");var j=str.replace(regex,"$2");return j;} function cell_click(event,e) {if(event.button=="0") {var i=get_i($(e).attr("id"));var j=get_j($(e).attr("id"));clear_cells(i,j);a_is_open[i][j]=true;} else if(event.button=="2") {if(!$(e).data("is_flagged")) {$(e).data("is_flagged",false);} if($(e).data("is_flagged")==false) {$(e).data("is_flagged",true);$(e).css("background-image",safe).css("background-repeat","no-repeat").css("background-position","50% 50%");;} else if($(e).css("background-image")==safe) {$(e).data("is_flagged",true);$(e).css("background-image",question).css("background-repeat","no-repeat").css("background-position","50% 50%");} else if($(e).css("background-image")==question) {$(e).data("is_flagged",false);$(e).css("background-image",null);}}} function clear_cells(i,j) {if(a_is_open[i][j]==false) {if(a_bombs[i][j]==true) {alert('you hit a bomb');} else {var ni=i-1;var ei=i;var si=i+1;var wi=i;var nj=j;var ej=j+1;var sj=j;var wj=j-1;if(ni>0&∋<nrow&&nj>0&&nj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[ni][nj]=a_num_bombs_near[ni][nj]+1;}} if(nei>0&&nei<nrow&&nej>0&&nej<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[nei][nej]=a_num_bombs_near[nei][nej]+1;}} if(ei>0&&ei<nrow&&ej>0&&ej<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[ei][ej]=a_num_bombs_near[ei][ej]+1;}} if(sei>0&&sei<nrow&&sej>0&&sej<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[sei][sej]=a_num_bombs_near[sei][sej]+1;}} if(si>0&&si<nrow&&sj>0&&sj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[si][sj]=a_num_bombs_near[si][sj]+1;}} if(swi>0&&swi<nrow&&swj>0&&swj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[swi][swj]=a_num_bombs_near[swi][swj]+1;}} if(wi>0&&wi<nrow&&wj>0&&wj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[wi][wj]=a_num_bombs_near[wi][wj]+1;}} if(nwi>0&&nwi<nrow&&nwj>0&&nwj<ncol) {if(a_bombs[i][j]==true) {a_num_bombs_near[nwi][nwj]=a_num_bombs_near[nwi][nwj]+1;}}}} else {}} function apply_css_default_style() {$("div.cell").css("border","2px solid #404040").css("background-color","gray").css("width","35px").css("height","35px").css("text-align","center").css("float","left");$("div.clear").css("width","0").css("height","0").css("margin","0").css("padding","0").css("clear","both");}
